# ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆ iPad è‡ªåŠ¨åŒ–åŠ©æ‰‹

åŸºäº USB è¿æ¥çš„ iPad è‡ªåŠ¨åŒ–æ§åˆ¶ç³»ç»Ÿï¼Œä¸“ä¸ºä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆæ¸¸æˆè®¾è®¡ï¼Œé€šè¿‡æˆªå›¾åˆ†æå’Œæ¨¡æ¿åŒ¹é…å®ç°æ™ºèƒ½æ“ä½œå»ºè®®å’Œè‡ªåŠ¨åŒ–æ‰§è¡Œã€‚

## ğŸ® é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®çš„æ ¸å¿ƒæ˜¯é€šè¿‡ USB ä¸ iPad è¿æ¥ï¼Œå®ç°å¯¹ iPad ä¸Šè¿è¡Œçš„ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆè¿›è¡Œæˆªå›¾ï¼Œå¹¶åˆ†æå½“å‰ç”¨æˆ·æ“ä½œï¼Œç»™å‡ºæ“ä½œå»ºè®®æˆ–è€…è‡ªåŠ¨åŒ–æ“ä½œã€‚ç³»ç»Ÿé‡‡ç”¨å…ˆè¿›çš„è§†è§‰è¯†åˆ«æŠ€æœ¯ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«æ¸¸æˆç•Œé¢å…ƒç´ ï¼Œä¸ºç©å®¶æä¾›æ™ºèƒ½åŒ–çš„æ¸¸æˆè¾…åŠ©ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”Œ USB è¿æ¥æŠ€æœ¯
- **ç¨³å®šè¿æ¥**: åŸºäº pymobiledevice3 å’Œ tunneld å®ç°çš„é«˜ç¨³å®šæ€§ USB è¿æ¥
- **å®æ—¶é€šä¿¡**: ä½å»¶è¿Ÿçš„è®¾å¤‡é€šä¿¡ï¼Œç¡®ä¿æ“ä½œå“åº”åŠæ—¶
- **è‡ªåŠ¨é‡è¿**: æ™ºèƒ½çš„è¿æ¥æ¢å¤æœºåˆ¶ï¼Œä¿è¯é•¿æ—¶é—´ç¨³å®šè¿è¡Œ

### ğŸ“¸ æ™ºèƒ½æˆªå›¾åˆ†æ
- **é«˜æ•ˆæˆªå›¾**: å®æ—¶è·å– iPad å±å¹•å†…å®¹ï¼Œæ”¯æŒé«˜åˆ†è¾¨ç‡æ˜¾ç¤º
- **æ¸¸æˆè¯†åˆ«**: ä¸“é—¨é’ˆå¯¹ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆç•Œé¢ä¼˜åŒ–çš„è¯†åˆ«ç®—æ³•
- **å…ƒç´ å®šä½**: ç²¾ç¡®è¯†åˆ«æŒ‰é’®ã€èœå•ã€åœ°å›¾ç­‰æ¸¸æˆå…ƒç´ 

### ğŸ§  æ™ºèƒ½å†³ç­–ç³»ç»Ÿ
- **æ“ä½œå»ºè®®**: åŸºäºå½“å‰æ¸¸æˆçŠ¶æ€æä¾›æœ€ä¼˜æ“ä½œå»ºè®®
- **è‡ªåŠ¨æ‰§è¡Œ**: æ”¯æŒå®Œå…¨è‡ªåŠ¨åŒ–çš„æ¸¸æˆæ“ä½œæ‰§è¡Œ
- **ç­–ç•¥åˆ†æ**: æ·±åº¦åˆ†ææ¸¸æˆå±€é¢ï¼Œæä¾›æˆ˜ç•¥çº§å»ºè®®

### ğŸ¯ æ¸¸æˆä¸“ç”¨åŠŸèƒ½
- **åœ°å›¾å¯¼èˆª**: æ™ºèƒ½çš„ä¸–ç•Œåœ°å›¾å’ŒåŸæ± å¯¼èˆª
- **èµ„æºç®¡ç†**: è‡ªåŠ¨åŒ–çš„èµ„æºæ”¶é›†å’Œç®¡ç†
- **æˆ˜æ–—è¾…åŠ©**: æˆ˜æ–—ç•Œé¢çš„æ™ºèƒ½æ“ä½œå»ºè®®
- **å»ºè®¾ä¼˜åŒ–**: åŸæ± å»ºè®¾çš„æœ€ä¼˜åŒ–å»ºè®®

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ğŸ“ sgzAss/
â”œâ”€â”€ ğŸ”§ src/                    # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ ğŸ“Š models/             # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ data_types.py      # æ¸¸æˆæ•°æ®ç±»å‹
â”‚   â”‚   â”œâ”€â”€ exceptions.py      # å¼‚å¸¸å¤„ç†
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ ğŸ› ï¸ services/           # æ ¸å¿ƒæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ connection.py      # iPad è¿æ¥æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ vision.py          # è§†è§‰è¯†åˆ«æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ automation.py      # è‡ªåŠ¨åŒ–æ‰§è¡ŒæœåŠ¡
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ ğŸ® core/               # æ¸¸æˆé€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ controller.py      # ä¸»æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ task_manager.py    # ä»»åŠ¡ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â””â”€â”€ ğŸ”¨ utils/              # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ logger.py          # æ—¥å¿—ç³»ç»Ÿ
â”‚       â”œâ”€â”€ helpers.py         # è¾…åŠ©å‡½æ•°
â”‚       â””â”€â”€ __init__.py
â”œâ”€â”€ ğŸ–¼ï¸ resources/              # æ¸¸æˆèµ„æº
â”‚   â”œâ”€â”€ templates/             # æ¨¡æ¿å›¾ç‰‡åº“
â”‚   â”‚   â”œâ”€â”€ attack_button.png  # æ”»å‡»æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ back_button.png    # è¿”å›æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ confirm_button.png # ç¡®è®¤æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ main_menu.png      # ä¸»èœå•
â”‚   â”‚   â”œâ”€â”€ world_map.png      # ä¸–ç•Œåœ°å›¾
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ screenshots/           # è‡ªåŠ¨æˆªå›¾å­˜å‚¨
â”œâ”€â”€ ğŸ› ï¸ tools/                  # å¼€å‘å·¥å…·
â”‚   â”œâ”€â”€ template_maker.py      # æ¨¡æ¿åˆ¶ä½œå·¥å…·
â”‚   â”œâ”€â”€ config_editor.py       # é…ç½®ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ analyze_logs.py        # æ—¥å¿—åˆ†æå·¥å…·
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸ“ logs/                   # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ âš™ï¸ config.yaml             # ä¸»é…ç½®æ–‡ä»¶
â””â”€â”€ ğŸ“– README.md               # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: macOS 10.15+ æˆ– Linux
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **è®¾å¤‡**: iPad (iOS 12+)
- **è¿æ¥**: USB æ•°æ®çº¿
- **æ¸¸æˆ**: ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆ App

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd sgzAss
```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
python -m venv .venv
source .venv/bin/activate  # macOS/Linux
# æˆ–
.venv\Scripts\activate     # Windows
```

3. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

4. **è®¾å¤‡å‡†å¤‡**
   - åœ¨ iPad ä¸Šå®‰è£…ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆ
   - å¯ç”¨ iPad å¼€å‘è€…æ¨¡å¼
   - ä½¿ç”¨ USB è¿æ¥ iPad åˆ°ç”µè„‘
   - åœ¨ iPad ä¸Šä¿¡ä»»æ­¤ç”µè„‘

### åŸºç¡€ä½¿ç”¨

```python
from src import quick_start, ExecutionMode

# å¯åŠ¨ç³»ç»Ÿ
controller, task_manager = quick_start(
    execution_mode=ExecutionMode.SUGGEST_ONLY  # å»ºè®®æ¨¡å¼
)

# è¿æ¥ iPad
print("æ­£åœ¨è¿æ¥ iPad...")
controller.connect()
print("è¿æ¥æˆåŠŸï¼")

# è·å–æ¸¸æˆæˆªå›¾
screenshot = controller.get_screenshot()
print(f"æˆªå›¾è·å–æˆåŠŸ: {screenshot.size}")

# åˆ†æå½“å‰æ¸¸æˆç•Œé¢
analysis = controller.analyze_screen(screenshot)
print(f"è¯†åˆ«åˆ° {len(analysis.elements)} ä¸ªæ¸¸æˆå…ƒç´ ")

# æŸ¥æ‰¾ç‰¹å®šæŒ‰é’®
attack_button = controller.find_element("attack_button.png")
if attack_button:
    print(f"å‘ç°æ”»å‡»æŒ‰é’®: {attack_button.location}")
    # è·å–æ“ä½œå»ºè®®
    suggestion = controller.get_action_suggestion(attack_button)
    print(f"å»ºè®®æ“ä½œ: {suggestion.description}")

# æ–­å¼€è¿æ¥
controller.disconnect()
```

## ğŸ® æ¸¸æˆåŠŸèƒ½

### ç•Œé¢è¯†åˆ«

ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆçš„å„ç§ç•Œé¢å…ƒç´ ï¼š

```python
# ä¸»ç•Œé¢è¯†åˆ«
main_menu = controller.find_element("main_menu.png")
if main_menu:
    print("å½“å‰åœ¨ä¸»ç•Œé¢")

# ä¸–ç•Œåœ°å›¾è¯†åˆ«
world_map = controller.find_element("world_map.png")
if world_map:
    print("å½“å‰åœ¨ä¸–ç•Œåœ°å›¾")
    # åˆ†æåœ°å›¾ä¸Šçš„å¯æ“ä½œå…ƒç´ 
    map_elements = controller.analyze_map_elements()
    for element in map_elements:
        print(f"å‘ç°: {element.type} - {element.description}")
```

### è‡ªåŠ¨åŒ–ä»»åŠ¡

```python
# åˆ›å»ºèµ„æºæ”¶é›†ä»»åŠ¡
task = task_manager.create_task("èµ„æºæ”¶é›†")

# æ·»åŠ ä»»åŠ¡æ­¥éª¤
task_manager.add_step(task.id, "ç‚¹å‡»ä¸»åŸ")
task_manager.add_step(task.id, "è¿›å…¥èµ„æºå»ºç­‘")
task_manager.add_step(task.id, "æ”¶é›†èµ„æº")
task_manager.add_step(task.id, "è¿”å›ä¸»ç•Œé¢")

# æ‰§è¡Œä»»åŠ¡
result = task_manager.execute_task(task.id)
if result.success:
    print(f"ä»»åŠ¡å®Œæˆ! æ”¶é›†äº† {result.resources_collected} èµ„æº")
```

### æˆ˜æ–—è¾…åŠ©

```python
# æˆ˜æ–—ç•Œé¢åˆ†æ
battle_analysis = controller.analyze_battle_screen()
print(f"æˆ‘æ–¹å…µåŠ›: {battle_analysis.our_troops}")
print(f"æ•Œæ–¹å…µåŠ›: {battle_analysis.enemy_troops}")
print(f"èƒœç‡é¢„æµ‹: {battle_analysis.win_probability:.1%}")

# è·å–æˆ˜æ–—å»ºè®®
battle_suggestion = controller.get_battle_suggestion(battle_analysis)
print(f"å»ºè®®ç­–ç•¥: {battle_suggestion.strategy}")
print(f"æ¨èæ“ä½œ: {battle_suggestion.recommended_actions}")
```

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»é…ç½®æ–‡ä»¶ (config.yaml)

```yaml
# iPad è¿æ¥é…ç½®
connection:
  timeout: 30              # è¿æ¥è¶…æ—¶æ—¶é—´(ç§’)
  retry_count: 3           # é‡è¯•æ¬¡æ•°
  tunneld_port: 5000       # tunneld ç«¯å£

# è§†è§‰è¯†åˆ«é…ç½®
vision:
  template_threshold: 0.8   # æ¨¡æ¿åŒ¹é…é˜ˆå€¼
  enable_vlm: false        # å¯ç”¨å¤§æ¨¡å‹è¯†åˆ«
  template_dir: "resources/templates"
  screenshot_dir: "resources/screenshots"

# è‡ªåŠ¨åŒ–é…ç½®
automation:
  backend: "webdriver"     # è‡ªåŠ¨åŒ–åç«¯
  execution_mode: "suggest" # æ‰§è¡Œæ¨¡å¼: execute/suggest
  action_delay: 0.5        # æ“ä½œé—´éš”(ç§’)
  click_duration: 0.1      # ç‚¹å‡»æŒç»­æ—¶é—´(ç§’)

# æ¸¸æˆç‰¹å®šé…ç½®
game:
  auto_screenshot: true    # è‡ªåŠ¨æˆªå›¾
  screenshot_interval: 5   # æˆªå›¾é—´éš”(ç§’)
  save_analysis_results: true  # ä¿å­˜åˆ†æç»“æœ

# æ—¥å¿—é…ç½®
logging:
  level: "INFO"
  file_enabled: true
  console_enabled: true
  performance_monitoring: true
```

## ğŸ› ï¸ å¼€å‘å·¥å…·

### æ¨¡æ¿åˆ¶ä½œå·¥å…·

```bash
# å¯åŠ¨æ¨¡æ¿åˆ¶ä½œå·¥å…·
python tools/template_maker.py
```

è¿™ä¸ªå·¥å…·å¸®åŠ©ä½ ï¼š
- ä»æ¸¸æˆæˆªå›¾ä¸­æå–ç•Œé¢å…ƒç´ 
- åˆ›å»ºé«˜è´¨é‡çš„æ¨¡æ¿å›¾ç‰‡
- æµ‹è¯•æ¨¡æ¿åŒ¹é…æ•ˆæœ
- æ‰¹é‡å¤„ç†æ¨¡æ¿æ–‡ä»¶

### é…ç½®ç¼–è¾‘å™¨

```bash
# å¯åŠ¨é…ç½®ç¼–è¾‘å™¨
python tools/config_editor.py
```

æä¾›å›¾å½¢åŒ–ç•Œé¢æ¥ï¼š
- ä¿®æ”¹ç³»ç»Ÿé…ç½®
- æµ‹è¯•è¿æ¥è®¾ç½®
- è°ƒæ•´è¯†åˆ«å‚æ•°
- å¯¼å…¥/å¯¼å‡ºé…ç½®

### æ—¥å¿—åˆ†æå·¥å…·

```bash
# åˆ†æç³»ç»Ÿæ—¥å¿—
python tools/analyze_logs.py --date 2024-01-20
```

åŠŸèƒ½åŒ…æ‹¬ï¼š
- æ€§èƒ½ç»Ÿè®¡åˆ†æ
- é”™è¯¯æ—¥å¿—æ±‡æ€»
- æ“ä½œæˆåŠŸç‡ç»Ÿè®¡
- ç”Ÿæˆåˆ†ææŠ¥å‘Š

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: iPad è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥è®¾å¤‡è¿æ¥
python tools/test_ipad_connection.py

# é‡å¯ tunneld æœåŠ¡
sudo pkill tunneld
python -m pymobiledevice3 remote tunneld
```

**Q: æ¨¡æ¿è¯†åˆ«ä¸å‡†ç¡®**
```python
# è°ƒæ•´è¯†åˆ«é˜ˆå€¼
config.vision.template_threshold = 0.9  # æé«˜ç²¾åº¦

# é‡æ–°åˆ¶ä½œæ¨¡æ¿
python tools/template_maker.py --retrain
```

**Q: æ“ä½œå»¶è¿Ÿè¿‡é«˜**
```yaml
# ä¼˜åŒ–é…ç½®
automation:
  action_delay: 0.2      # å‡å°‘å»¶è¿Ÿ
  enable_fast_mode: true # å¯ç”¨å¿«é€Ÿæ¨¡å¼
```

### è°ƒè¯•æ¨¡å¼

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.getLogger().setLevel(logging.DEBUG)

# å¯ç”¨æ€§èƒ½ç›‘æ§
controller.enable_performance_monitoring()

# ä¿å­˜è°ƒè¯•æˆªå›¾
controller.enable_debug_screenshots()
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. **Fork é¡¹ç›®**
2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**: `git checkout -b feature/amazing-feature`
3. **æäº¤æ›´æ”¹**: `git commit -m 'Add amazing feature'`
4. **æ¨é€åˆ†æ”¯**: `git push origin feature/amazing-feature`
5. **åˆ›å»º Pull Request**

### å¼€å‘è§„èŒƒ

- éµå¾ª PEP 8 ä»£ç é£æ ¼
- æ·»åŠ ç±»å‹æ³¨è§£
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ã€‚ä½¿ç”¨æœ¬è½¯ä»¶æ—¶è¯·ï¼š

- éµå®ˆæ¸¸æˆæœåŠ¡æ¡æ¬¾
- ä¸è¦ç”¨äºå•†ä¸šç”¨é€”
- å°Šé‡æ¸¸æˆå…¬å¹³æ€§
- æ‰¿æ‹…ä½¿ç”¨é£é™©

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœä½ é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼š

1. ğŸ“– æŸ¥çœ‹[æ–‡æ¡£](docs/)
2. ğŸ” æœç´¢[å·²çŸ¥é—®é¢˜](issues)
3. ğŸ’¬ åˆ›å»º[æ–°é—®é¢˜](issues/new)
4. ğŸ“§ è”ç³»å¼€å‘è€…

---

**è®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æœ€æ™ºèƒ½çš„ä¸‰å›½å¿—æˆ˜ç•¥ç‰ˆåŠ©æ‰‹ï¼** ğŸ®âœ¨