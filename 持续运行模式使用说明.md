# 持续运行模式使用说明

## 修复内容

### 1. API调用间隔优化
- **默认间隔**: 从5秒调整为60秒
- **最小间隔**: 从1秒调整为30秒
- **目的**: 避免大模型API调用超时，确保服务稳定性

### 2. 操作建议显示优化
- **详细信息**: 显示建议类型、位置坐标、优先级、置信度
- **清晰格式**: 使用分隔线和图标区分不同建议
- **优先级标识**: 高优先级建议（≥0.7）使用⚡图标特别标注

### 3. 配置一致性保证
- 配置文件、配置类、CLI代码三者保持同步
- 确保所有组件使用相同的默认值和限制

## 使用方法

### 启动持续运行模式

1. 运行游戏助手：
   ```bash
   python run_game_assistant.py
   ```

2. 选择持续运行模式：
   ```
   输入: 6 或 continuous
   ```

3. 配置参数：
   - **分析间隔**: 建议使用默认60秒，最小30秒
   - **最大运行次数**: 0表示无限制
   - **自动执行**: 是否自动执行高优先级建议

### 示例配置

```
请输入分析间隔时间（秒，默认60秒）: [直接回车使用默认值]
请输入最大运行次数（0表示无限制，默认0）: 10
是否自动执行高优先级建议？(y/n，默认n): y
```

## 输出示例

### 分析结果显示
```
🔍 第 1 次分析 (10:30:15)
✅ 分析完成 (耗时: 2.34秒, 置信度: 0.85)
🎯 发现元素: 5个, 操作建议: 3个

💡 操作建议详情:
--------------------------------------------------
⚡ 1. 点击建造按钮
   类型: click
   位置: (100, 200)
   优先级: 0.80
   置信度: 0.90

💡 2. 滑动查看更多
   类型: swipe
   位置: (300, 400)
   优先级: 0.60
   置信度: 0.85

⚡ 3. 长按选择单位
   类型: long_press
   位置: (500, 600)
   优先级: 0.75
   置信度: 0.88

⚡ 检测到 2 个高优先级建议
🚀 自动执行建议 1: 点击建造按钮
✅ 执行成功
🚀 自动执行建议 2: 长按选择单位
✅ 执行成功

⏱️ 等待 60 秒后进行下次分析...
```

### 无建议时的显示
```
🔍 第 2 次分析 (10:31:15)
✅ 分析完成 (耗时: 1.89秒, 置信度: 0.72)
🎯 发现元素: 3个, 操作建议: 0个

💭 本次分析未发现可执行的操作建议

⏱️ 等待 60 秒后进行下次分析...
```

## 注意事项

### 1. 间隔时间设置
- **推荐**: 使用默认60秒间隔
- **最小**: 不低于30秒，避免API超时
- **调整**: 根据网络状况和API响应速度适当调整

### 2. 自动执行模式
- **谨慎使用**: 自动执行可能影响游戏状态
- **监控**: 建议在有人监控的情况下使用
- **测试**: 先在测试环境验证建议的准确性

### 3. 停止运行
- **快捷键**: 按 `Ctrl+C` 随时停止
- **统计信息**: 停止时会显示总分析次数
- **日志记录**: 所有操作都会记录到日志文件

## 配置文件设置

在 `config.yaml` 中可以预设持续运行模式的默认参数：

```yaml
async_analysis:
  continuous_mode:
    enabled: false           # 是否启用持续运行模式
    default_interval: 60.0   # 默认分析间隔（秒）
    min_interval: 30.0       # 最小分析间隔（秒）
    max_iterations: 0        # 默认最大运行次数
    auto_execute: false      # 是否自动执行高优先级建议
    priority_threshold: 0.7  # 高优先级建议阈值
    save_results: true       # 是否保存分析结果
    results_dir: "logs/continuous_results"  # 结果保存目录
```

## 故障排除

### API超时问题
- **现象**: 频繁出现API调用超时
- **解决**: 增加分析间隔时间（建议≥60秒）
- **检查**: 确认网络连接和Ollama服务状态

### 建议不显示问题
- **现象**: 分析完成但看不到具体建议
- **解决**: 已修复，现在会详细显示所有建议信息
- **验证**: 查看"💡 操作建议详情"部分

### 配置不生效问题
- **现象**: 设置的参数没有生效
- **解决**: 检查配置文件格式和路径
- **重启**: 修改配置后重启程序

## 性能优化建议

1. **合理设置间隔**: 根据游戏节奏调整分析频率
2. **监控资源使用**: 注意CPU和内存占用
3. **定期清理日志**: 避免日志文件过大
4. **网络优化**: 确保稳定的网络连接
5. **模型选择**: 根据需要选择合适的VLM模型