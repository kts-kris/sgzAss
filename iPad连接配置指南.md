# iPad连接配置指南

## 概述

本指南将帮助您正确配置iPad连接，以便自动化助手能够获取iPad屏幕截图并执行操作。

## 连接方式选择

### 1. 网络连接（推荐）

**优点：**
- 无需USB线缆
- 连接稳定
- 支持远程操作

**要求：**
- iPad和电脑在同一WiFi网络
- 在iPad上安装服务端应用

### 2. USB连接（开发中）

**优点：**
- 连接速度快
- 不依赖网络

**状态：** 功能正在开发中

### 3. 模拟模式（仅用于测试）

**用途：** 截取电脑屏幕进行功能测试
**注意：** 不是真正的iPad连接

## 网络连接配置步骤

### 步骤1：获取iPad IP地址

1. 在iPad上打开 **设置**
2. 点击 **WiFi**
3. 点击当前连接的WiFi网络名称
4. 记录显示的 **IP地址**（例如：192.168.1.100）

### 步骤2：安装iPad服务端应用

由于iOS系统的限制，我们需要一个第三方应用来提供屏幕共享服务。

**推荐方案：**

#### 方案A：使用AirServer或类似应用
1. 在iPad上安装AirServer Connect
2. 启动应用并配置网络访问
3. 记录应用提供的端口号

#### 方案B：使用开发者工具
1. 如果您有开发者账号，可以安装自定义的屏幕共享应用
2. 使用WebDriverAgent等工具

#### 方案C：使用VNC服务
1. 在iPad上安装支持VNC的应用
2. 配置VNC服务器
3. 使用5900端口（VNC默认端口）

### 步骤3：测试连接

1. 运行连接测试工具：
   ```bash
   python tools/test_ipad_connection.py
   ```

2. 选择 "1. 网络连接"

3. 输入iPad的IP地址

4. 输入端口号（通常是5555或5900）

5. 测试连接和截图功能

### 步骤4：配置环境变量

如果连接成功，工具会提示您保存配置到`.env`文件：

```env
CONNECTION_TYPE=network
DEVICE_IP=192.168.1.100
DEVICE_PORT=5555
SCREEN_WIDTH=2732
SCREEN_HEIGHT=2048
LOG_LEVEL=DEBUG
```

## 故障排除

### 连接失败的常见原因

1. **网络问题**
   - iPad和电脑不在同一WiFi网络
   - 防火墙阻止连接
   - 路由器设置阻止设备间通信

2. **IP地址问题**
   - IP地址输入错误
   - iPad的IP地址已更改（DHCP动态分配）

3. **端口问题**
   - 端口号错误
   - 端口被其他程序占用
   - iPad上的服务未启动

### 诊断步骤

1. **测试网络连通性**
   ```bash
   ping 192.168.1.100
   ```

2. **测试端口连通性**
   ```bash
   telnet 192.168.1.100 5555
   ```

3. **检查防火墙设置**
   - 暂时关闭电脑防火墙进行测试
   - 确保iPad上的应用有网络权限

4. **检查路由器设置**
   - 确保路由器允许设备间通信
   - 检查是否启用了AP隔离

## 替代方案

### 使用ADB over WiFi（Android方式的iOS替代）

虽然iOS不支持ADB，但可以使用类似的工具：

1. **iOS App Installer**
2. **3uTools**
3. **iMazing**

### 使用屏幕镜像

1. **AirPlay镜像到Mac**
   - 使用QuickTime Player录制iPad屏幕
   - 通过屏幕共享获取镜像内容

2. **第三方镜像软件**
   - Reflector
   - AirServer
   - LonelyScreen

## 当前状态检查

运行以下命令检查当前配置：

```bash
# 查看当前配置
cat .env

# 测试连接
python tools/test_ipad_connection.py

# 运行主程序（短时间测试）
python main.py --debug --duration 10
```

## 下一步

1. **如果网络连接成功**：
   - 保存配置到`.env`文件
   - 运行主程序进行完整测试
   - 收集更多游戏模板

2. **如果网络连接失败**：
   - 尝试其他连接方案
   - 使用模拟模式进行功能测试
   - 考虑使用USB连接（待开发）

3. **临时解决方案**：
   - 使用模拟模式测试程序功能
   - 在iPad上手动截图并传输到电脑进行模板制作
   - 等待USB连接功能完成开发

## 技术支持

如果您在配置过程中遇到问题，请：

1. 检查日志文件：`logs/sgz_assistant.log`
2. 运行诊断工具：`python tools/test_ipad_connection.py`
3. 查看详细错误信息并根据故障排除指南操作

---

**注意：** 由于iOS系统的安全限制，iPad连接比Android设备更复杂。如果遇到困难，建议先使用模拟模式测试程序功能，然后再解决连接问题。