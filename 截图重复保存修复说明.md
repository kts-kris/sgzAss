# æˆªå›¾é‡å¤ä¿å­˜é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆæ¸¸æˆåŠ©æ‰‹æ¯æ¬¡ä¼šç”Ÿæˆä¸¤å¼ å†…å®¹å®Œå…¨ç›¸åŒä½†å‘½åä¸åŒçš„æˆªå›¾ï¼š
- `game_screen_xxxxx.png`
- `auto_screenshot_xxxx_xxx.png`

è¿™ä¸¤å¼ æˆªå›¾å†…å®¹å®Œå…¨ä¸€æ ·ï¼Œé€ æˆäº†å­˜å‚¨ç©ºé—´çš„æµªè´¹å’Œæ–‡ä»¶ç®¡ç†çš„æ··ä¹±ã€‚

## é—®é¢˜åŸå› åˆ†æ

é€šè¿‡ä»£ç åˆ†æå‘ç°ï¼Œé‡å¤æˆªå›¾çš„äº§ç”Ÿæºäºä¸¤ä¸ªç‹¬ç«‹çš„ä¿å­˜æœºåˆ¶ï¼š

1. **è‡ªåŠ¨ä¿å­˜æœºåˆ¶** (`src/services/connection.py`)
   - åœ¨ `get_screenshot()` æ–¹æ³•ä¸­è°ƒç”¨ `_auto_save_screenshot_if_enabled()`
   - å½“ `config.auto_save_screenshots = true` æ—¶è‡ªåŠ¨ä¿å­˜
   - æ–‡ä»¶å‘½åæ ¼å¼ï¼š`auto_screenshot_yyyymmdd_hhmmss_xxx.png`

2. **åˆ†æä¿å­˜æœºåˆ¶** (`src/controllers/game_assistant.py`)
   - åœ¨ `analyze_current_screen()` æ–¹æ³•ä¸­
   - å½“ `save_screenshot = True` æ—¶ä¿å­˜
   - æ–‡ä»¶å‘½åæ ¼å¼ï¼š`game_screen_xxxxx.png`

## ä¿®å¤æ–¹æ¡ˆ

### 1. é…ç½®æ–‡ä»¶ä¿®æ”¹ (`config.yaml`)

```yaml
# ç¦ç”¨è‡ªåŠ¨ä¿å­˜ï¼Œé¿å…é‡å¤æˆªå›¾
auto_save_screenshots: false

# æ–°å¢åˆ†ææˆªå›¾ä¿å­˜æ§åˆ¶
save_analysis_screenshots: true
```

### 2. é…ç½®ç±»æ›´æ–° (`src/utils/config.py`)

åœ¨ `SystemConfig` ç±»ä¸­æ·»åŠ æ–°å­—æ®µï¼š

```python
class SystemConfig(BaseModel):
    # ... å…¶ä»–å­—æ®µ ...
    auto_save_screenshots: bool = False
    save_analysis_screenshots: bool = True  # æ˜¯å¦ä¿å­˜åˆ†ææ—¶çš„æˆªå›¾
```

### 3. æ¸¸æˆåŠ©æ‰‹é€»è¾‘ä¼˜åŒ– (`src/controllers/game_assistant.py`)

æ›´æ–°æˆªå›¾ä¿å­˜é€»è¾‘ï¼Œé¿å…é‡å¤ä¿å­˜ï¼š

```python
# ä¿å­˜åˆ†ææˆªå›¾ï¼ˆå¦‚æœå¯ç”¨ä¸”æœªå¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼‰
if save_screenshot and self.config.save_analysis_screenshots and not self.config.auto_save_screenshots:
    # ä½¿ç”¨ ScreenshotManager çš„ä¿å­˜åŠŸèƒ½ï¼Œé¿å…é‡å¤ä¿å­˜
    timestamp = int(time.time())
    filename = f"analysis_screenshot_{timestamp}.png"
    # ... ä¿å­˜é€»è¾‘ ...
elif save_screenshot and self.config.auto_save_screenshots:
    logger.debug("æˆªå›¾å·²é€šè¿‡è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ä¿å­˜ï¼Œè·³è¿‡é‡å¤ä¿å­˜")
elif save_screenshot and not self.config.save_analysis_screenshots:
    logger.debug("åˆ†ææˆªå›¾ä¿å­˜å·²ç¦ç”¨ï¼Œè·³è¿‡ä¿å­˜")
```

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- æ¯æ¬¡åˆ†æç”Ÿæˆ 2 å¼ ç›¸åŒæˆªå›¾
- æ–‡ä»¶å‘½åæ··ä¹±ï¼š`game_screen_xxxxx.png` + `auto_screenshot_xxxx_xxx.png`
- å­˜å‚¨ç©ºé—´æµªè´¹

### ä¿®å¤å
- æ¯æ¬¡åˆ†æåªç”Ÿæˆ 1 å¼ æˆªå›¾
- ç»Ÿä¸€æ–‡ä»¶å‘½åï¼š`analysis_screenshot_xxxxx.png`
- èŠ‚çœå­˜å‚¨ç©ºé—´
- æ–‡ä»¶ç®¡ç†æ›´æ¸…æ™°

## é…ç½®è¯´æ˜

### å…³é”®é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `auto_save_screenshots` | `false` | ç¦ç”¨è¿æ¥å±‚è‡ªåŠ¨ä¿å­˜ |
| `save_analysis_screenshots` | `true` | å¯ç”¨åˆ†ææ—¶ä¿å­˜æ§åˆ¶ |

### æˆªå›¾ä¿å­˜è¡Œä¸º

| åœºæ™¯ | auto_save | save_analysis | save_screenshot | ç»“æœ |
|------|-----------|---------------|-----------------|------|
| æ­£å¸¸åˆ†æ | false | true | true | ä¿å­˜ analysis_screenshot_xxxxx.png |
| ç¦ç”¨åˆ†æä¿å­˜ | false | false | true | ä¸ä¿å­˜ |
| å¯ç”¨è‡ªåŠ¨ä¿å­˜ | true | true | true | è·³è¿‡ä¿å­˜ï¼ˆé¿å…é‡å¤ï¼‰ |

## éªŒè¯æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ä¿®å¤æ•ˆæœï¼š

```bash
python test_screenshot_simple.py
```

### æµ‹è¯•ç»“æœ

```
âœ… é…ç½®éªŒè¯:
  âœ“ auto_save_screenshots å·²æ­£ç¡®è®¾ç½®ä¸º False
  âœ“ save_analysis_screenshots å·²æ­£ç¡®è®¾ç½®ä¸º True

ğŸ“Š æˆªå›¾æ–‡ä»¶ç»Ÿè®¡:
æ€»æ–‡ä»¶æ•°: 34
game_screen_ æ–‡ä»¶: 12 (å†å²æ–‡ä»¶)
auto_screenshot_ æ–‡ä»¶: 21 (å†å²æ–‡ä»¶)
analysis_screenshot_ æ–‡ä»¶: 0 (æ–°æ ¼å¼ï¼Œå¾…ç”Ÿæˆ)
```

## ä½¿ç”¨å»ºè®®

1. **ä¿æŒé»˜è®¤é…ç½®**ï¼šæ¨èä½¿ç”¨ä¿®å¤åçš„é»˜è®¤é…ç½®
2. **å®šæœŸæ¸…ç†**ï¼šå¯ä»¥å®šæœŸæ¸…ç†å†å²çš„é‡å¤æˆªå›¾æ–‡ä»¶
3. **ç›‘æ§å­˜å‚¨**ï¼šå…³æ³¨æˆªå›¾ç›®å½•çš„å­˜å‚¨ä½¿ç”¨æƒ…å†µ

## æ³¨æ„äº‹é¡¹

1. ä¿®å¤åçš„æˆªå›¾æ–‡ä»¶åæ ¼å¼ä¸º `analysis_screenshot_xxxxx.png`
2. å†å²çš„é‡å¤æˆªå›¾æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†
3. å¦‚éœ€æ¢å¤è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œå¯å°† `auto_save_screenshots` è®¾ä¸º `true`

## æ€»ç»“

é€šè¿‡ç¦ç”¨è‡ªåŠ¨ä¿å­˜æœºåˆ¶å¹¶ä¼˜åŒ–åˆ†æä¿å­˜é€»è¾‘ï¼ŒæˆåŠŸè§£å†³äº†æˆªå›¾é‡å¤ä¿å­˜çš„é—®é¢˜ã€‚ä¿®å¤åç³»ç»Ÿå°†ï¼š

- âœ… é¿å…ç”Ÿæˆé‡å¤æˆªå›¾
- âœ… èŠ‚çœå­˜å‚¨ç©ºé—´
- âœ… ç®€åŒ–æ–‡ä»¶ç®¡ç†
- âœ… ä¿æŒåˆ†æåŠŸèƒ½å®Œæ•´æ€§

ä¿®å¤å·²é€šè¿‡æµ‹è¯•éªŒè¯ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚